/*
 * This Kotlin source file was generated by the Gradle 'init' task.
 */
package logikcull.loadfiles

class App {
    fun parse(pathname: String): Loadfile {
        return Loadfile.from(pathname)
    }
}

fun main(args: Array<String>) {
    if (args.isEmpty()) {
        System.err.println("usage: gradle run --args 'path/to/loadfile1.opt path/to/loadfile2.opt'")
    }

    for (path in args) {
        try {
            App().parse(path).use { loadfile ->
                println("| Loadfile: %-66s |\n".format(path))
                println("| Control Number      | Volume              | Path                             |")
                println("| ------------------- | ------------------- | -------------------------------- |")
                for (entry in loadfile.entries) {
                    println("| %-19s | %-19s | %-32s |\n".format(entry.controlNumber, entry.volumeName, entry.path))
                }

                val validatorResult = loadfile.validate()
                val isValid = validatorResult.all { entry -> entry.second.isEmpty() }
                println("| Loadfile is valid: $isValid\n")

                if(!isValid) {
                    println("| Invalid Entries: \n")
                    for(entry in validatorResult) {
                        println("| ${entry.first}")
                        println("| ------------------- | ------------------- | -------------------------------- |")
                        entry.second.forEach { println("| %-19s | %-19s | %-32s |\n".format(it.controlNumber, it.volumeName, it.path)) }
                    }
                }

                println("")
            }
        } catch (e: Exception) {
            e.printStackTrace(System.err)
        }
    }
}
